@model SellerBox.ViewModels.Auction.AuctionViewModel

@section styles {
    <script src="//vk.com/js/api/openapi.js?159" type="text/javascript"></script>
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet" type="text/css" />
   
}
@section scripts {
    <script type="text/javascript">
        VK.init({
            apiId: @ViewBag.AppId
        });
    </script>
    <script src="~/lib/chart.js/dist/Chart.bundle.min.js"></script>
    <script src="https://npmcdn.com/flatpickr/dist/flatpickr.min.js"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ru.js"></script>
    <script src="~/lib/site/Auction/datatime.js"></script>
}

@{
    ViewBag.Title = "Создание аукциона";
}

 
<form id="auction" asp-antiforgery="true" asp-action="Create" method="post">
    <div asp-validation-summary="All" class="text-danger"></div>
    <div class="input-group-prepend">
        <label asp-for="Name" class="input-group-text"></label>
        <input id="name" asp-for="Name" class="form-control" />
    </div>
    <div class="input-group-prepend">
        <label asp-for="Description" class="input-group-text"></label>
        <input id="description" asp-for="Description" class="form-control" />
    </div>
    <div class="input-group-prepend">
        <label asp-for="StartDate" class="input-group-text"></label>
        <input id="startDate" asp-for="StartDate" type="text" style="background-color: white" class="form-control" placeholder="Выберите дату и время.." data-input value="@DateTime.Now">
        <div class="input-group-append">
            <button type="button" class="btn btn-outline-success form-control" title="toggle" data-toggle>
                <img src="~/images/Calendar.png" />
            </button>

            <button type="button" class="btn btn-outline-secondary form-control" title="clear" data-clear>
                <img src="~/images/Close.png" />
            </button>
        </div>
    </div>
    <div class="input-group-prepend">
        <label asp-for="EndDate" class="input-group-text"></label>
        <input id="endDate" asp-for="EndDate" type="text" style="background-color: white" class="form-control" placeholder="Выберите дату и время.." data-input value="@DateTime.Now.AddDays(1)" >
        <div class="input-group-append">
            <button type="button" class="btn btn-outline-success form-control" title="toggle" data-toggle>
                <img src="~/images/Calendar.png" />
            </button>

            <button type="button" class="btn btn-outline-secondary form-control" title="clear" data-clear>
                <img src="~/images/Close.png" />
            </button>
        </div>
    </div>
    <div class="input-group-prepend">
        <label asp-for="StartPrice" class="input-group-text"></label>
        <input id="startprice" asp-for="StartPrice" class="form-control" />
    </div>
    <div class="input-group-prepend">
        <label asp-for="PriceStep" class="input-group-text"></label>
        <input id="pricestep" asp-for="PriceStep" class="form-control" />
    </div>
    <div class="input-group-prepend">
        <label asp-for="MaxPrice" class="input-group-text"></label>
        <input id="maxprice" asp-for="MaxPrice" class="form-control" />
    </div>
    <div class="input-group-prepend">
        <label asp-for="MaxCommentsCount" class="input-group-text"></label>
        <input asp-for="MaxCommentsCount" class="form-control" />
    </div>
    <!--
    <div class="input-group-prepend">
        <label class="input-group-text">Опубликовать от имени группы</label>
        <div class="checkbox">
            <input type="checkbox" checked="checked"/>
        </div>
    </div>
    -->
    <input type="hidden" id="idPost" name="idPost" />
    <input id="btnpost" type="button" value="Опубликовать" class="btn btn-primary" onclick="auth()" />
    <input type="submit" value="Сохранить" class="btn btn-success" />
</form>
<script type="text/javascript">
    function auth() {
        VK.Auth.login(authInfo, '8192');
    }
    function authInfo(response) {
        if (response.session) {
            Wall();
        }
    }

    function Wall() {
        //var fromgroup = $(document).getElementById("IsAdmin").checked ? 1 : 0;
        var title = document.getElementById("name").value;
        var description = document.getElementById("description").value;
        var startprice = document.getElementById("startprice").value;
        var pricestep = document.getElementById("pricestep").value;
        var maxprice = document.getElementById("maxprice").value;
        VK.Api.call('wall.post',
            {
                owner_id: @ViewBag.OwnerId,
                friends_only: 0,
                from_group: 1,
                message: title.toString() + "\r\n" + description.toString() +
                    "\r\n" + "начальная цена: " + startprice.toString() 
                    + " шаг цены: " + pricestep + " максимальная цена: " + maxprice,
                signed: 0,
                mark_as_ads: 0,
                close_comment: 0,
                v: "5.87"
            },
            function(r) {
                if (r.response) {
                    document.getElementById("idPost").value = r.response.post_id;
                }
            });
    }
</script>
